<div class="share-movie-dialog">
  <div class="dialog-header">
    <div class="header-content">
      <div class="header-icon">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
        </svg>
      </div>
      <div>
        <h2 class="dialog-title">Share Movie</h2>
        <p class="dialog-subtitle">{{ data.movieTitle }}</p>
      </div>
    </div>
    <button class="close-btn" (click)="onCancel()">
      <svg fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
      </svg>
    </button>
  </div>

  <mat-dialog-content class="dialog-content">
    <!-- Loading State -->
    <div *ngIf="loading()" class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Loading friends...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error()" class="error-message">
      <p>{{ error() }}</p>
      <button mat-button (click)="loadFriends()">Retry</button>
    </div>

    <!-- Friends List -->
    <div *ngIf="!loading() && !error()" class="friends-container">
      <!-- No Friends Message -->
      <div *ngIf="friends().length === 0" class="no-friends">
        <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
        </svg>
        <p class="empty-title">No Friends Yet</p>
        <p class="empty-subtitle">Add some friends to start sharing great movies!</p>
      </div>

      <!-- Friends Selection -->
      <div *ngIf="friends().length > 0" class="friends-list">
        <div class="selection-actions">
          <button class="action-btn" (click)="selectAll()">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            Select All
          </button>
          <button class="action-btn" (click)="deselectAll()">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
            Clear
          </button>
          <div class="selected-count">
            <svg fill="currentColor" viewBox="0 0 20 20" width="16" height="16">
              <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
            </svg>
            {{ selectedFriends().size }} selected
          </div>
        </div>

        <div class="friend-items">
          <div
            *ngFor="let friend of friends()"
            class="friend-item"
            [class.selected]="isFriendSelected(friend.id)"
            (click)="toggleFriend(friend.id)"
          >
            <mat-checkbox
              [checked]="isFriendSelected(friend.id)"
              (click)="$event.stopPropagation()"
              (change)="toggleFriend(friend.id)"
            ></mat-checkbox>

            <div class="friend-avatar">
              <img
                *ngIf="friend.profilePictureUrl"
                [src]="friend.profilePictureUrl"
                [alt]="friend.fullName"
              />
              <div *ngIf="!friend.profilePictureUrl" class="avatar-placeholder">
                {{ friend.firstName.charAt(0) }}{{ friend.lastName.charAt(0) }}
              </div>
            </div>

            <div class="friend-info">
              <div class="friend-name">{{ friend.fullName }}</div>
              <div class="friend-username">@{{ friend.username }}</div>
            </div>
          </div>
        </div>

        <!-- Optional Message -->
        <mat-form-field class="message-field" appearance="outline">
          <mat-label>Add a message (optional)</mat-label>
          <textarea
            matInput
            [(ngModel)]="message"
            placeholder="Why do you recommend this movie?"
            rows="3"
            maxlength="500"
          ></textarea>
          <mat-hint align="end">{{ message().length }}/500</mat-hint>
        </mat-form-field>
      </div>
    </div>
  </mat-dialog-content>

  <div class="dialog-actions">
    <button class="btn btn-secondary" (click)="onCancel()">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="18" height="18">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
      Cancel
    </button>
    <button
      class="btn btn-primary"
      (click)="onShare()"
      [disabled]="!canShare || loading()"
      [class.disabled]="!canShare || loading()"
    >
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="18" height="18">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
      </svg>
      Share with {{ selectedFriends().size }} friend{{ selectedFriends().size !== 1 ? 's' : '' }}
    </button>
  </div>
</div>
